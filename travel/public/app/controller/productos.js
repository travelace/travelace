/*
 * File: app/controller/agencias.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('app.controller.productos', {
    extend: 'Ext.app.Controller',
    alias: 'controller.productos',
    refs: {
        productos: {
            autoCreate: true,
            selector: 'productos',
            xtype: 'productos'
        }
    },
    control: {
        "#productosGrilla": {
            select: 'cargarProductos'
        },
        "#modulos": {
            change: 'guardarModulos'
        },
        "#diasA":{
            change: 'guardarDias'
        },
        "#maxP":{
          change: 'guardarMaxP'  
        },
        "limiteD":{
            change: 'guardarLimiteD'
        },
        "edadM":{
            change: 'guardadEdadM'
        },
        "descuentoF":{
            change: 'descuentoF'
        }
    },
    cargarProductos: function (dv, record, item, index, e) {

        var me=this;
        var nombre = record.data.nombre;
        var codigo = record.data.codigo;
        this.getProductos().down('#agenciaSeleccionada').setValue(nombre);
        this.getProductos().down('#agenciaSeleccionadaCodigo').setValue(codigo);
        Ext.Ajax.request({
            url: './productos/consultaProductos/'+codigo,
            method: 'POST',
            success: function (response) {
                var respuesta = JSON.parse(response.responseText);
                //console.log(respuesta.producto[0].modulo);
                me.getProductos().down('#modulos').setValue({modulo: respuesta.producto[0].modulo})
                me.getProductos().down('#diasA').setValue(respuesta.producto[0].dias)
                me.getProductos().down('#maxP').setValue(respuesta.producto[0].maxp)
                me.getProductos().down('#limiteD').setValue(respuesta.producto[0].limited)
                me.getProductos().down('#edadM').setValue(respuesta.producto[0].edadm)
                me.getProductos().down('#edadMin').setValue(respuesta.producto[0].edadmin)
                me.getProductos().down('#descuentoF').setValue(respuesta.producto[0].descuentof)
                me.getProductos().down('#recargoE').setValue(respuesta.producto[0].recargoe)
                me.getProductos().down('#mayoresA').setValue(respuesta.producto[0].mayoresa)
                me.getProductos().down('#porcentajeR').setValue(respuesta.producto[0].porcentajer)
                me.getProductos().down('#corporativo').setValue(respuesta.producto[0].corporativo)
                me.getProductos().down('#largaestadia').setValue(respuesta.producto[0].largaestadia)
                me.getProductos().down('#largaestadiatarifa').setValue(respuesta.producto[0].largaestadiatarifa)
                me.getProductos().down('#modulosdm').setValue({modulodm: respuesta.producto[0].modulodm})
                me.getProductos().down('#largaestadialimi').setValue(respuesta.producto[0].largaestadialimi)
                me.getProductos().down('#anual').setValue(respuesta.producto[0].anual)
                me.getProductos().down('#descuento').setValue(respuesta.producto[0].descuento)
                me.getProductos().down('#dosporuno').setValue(respuesta.producto[0].dosporuno)
                me.getProductos().down('#iniciopromo').setValue(respuesta.producto[0].iniciopromo)
                me.getProductos().down('#finpromo').setValue(respuesta.producto[0].finpromo)

            }
        });
     
        this.getProductos().down('#productoSeleccionado').setValue(codigo);
        store_tarifas =  this.getProductos().down("#tarifasGrilla").getStore();
        
        store_tarifas.load({
            params: {
                codigo: codigo,
                tipoTransaccion: 'cargar'
            }
        });


    },
    guardarModulos: function (field, newValue, oldValue, eOpts) {

        modulo = newValue.modulo;
        codigoProducto = this.getProductos().down('#agenciaSeleccionadaCodigo').value;
        Ext.Ajax.request({
            url: './productos/guardarModulos/' + modulo + '/' + codigoProducto,
            method: 'POST',
            success: function (response) {

            }
        })



    },
     guardarDias: function (field, newValue, oldValue, eOpts) {

        dias = newValue.diasA;
        codigoProducto = this.getProductos().down('#agenciaSeleccionadaCodigo').value;
        Ext.Ajax.request({
            url: './productos/guardarDias/' + dias + '/' + codigoProducto,
            method: 'POST',
            success: function (response) {

            }
        })
        
        
  
      },
      guardarMaxP: function (field, newValue, oldValue, eOpts) {

        maxp = newValue.diasA;
        codigoProducto = this.getProductos().down('#agenciaSeleccionadaCodigo').value;
        Ext.Ajax.request({
            url: './productos/guardarMaxP/' + maxp + '/' + codigoProducto,
            method: 'POST',
            success: function (response) {

            }
        })
        
        
  
      }


});
